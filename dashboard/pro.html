<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KameLionStack - LLM Pentesting</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #0a0e27;
            color: #e4e4e7;
            min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 30px; }
        
        .header {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .header h1 {
            font-size: 2.2rem;
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        .header .subtitle {
            color: #94a3b8;
            font-size: 1rem;
        }

        .scan-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
        }
        
        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        .mode-btn {
            background: #334155;
            border: 2px solid #475569;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        .mode-btn:hover {
            border-color: #60a5fa;
            background: #475569;
        }
        .mode-btn.active {
            border-color: #3b82f6;
            background: #1e3a5f;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        .mode-btn.ai-mode.active {
            border-color: #a855f7;
            background: #3e1e5f;
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
        }
        .mode-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .mode-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #e4e4e7;
        }
        .mode-desc {
            font-size: 0.85rem;
            color: #94a3b8;
            line-height: 1.4;
        }
        .mode-time {
            font-size: 0.75rem;
            color: #60a5fa;
            margin-top: 8px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #e4e4e7;
        }
        .form-input {
            width: 100%;
            padding: 14px 18px;
            background: #0f172a;
            border: 2px solid #334155;
            border-radius: 8px;
            color: #e4e4e7;
            font-size: 1rem;
            transition: all 0.3s;
        }
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .form-input::placeholder {
            color: #64748b;
        }

        .btn {
            padding: 14px 28px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.5);
        }
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .btn-ai {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);
        }
        .btn-ai:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(168, 85, 247, 0.5);
        }

        .results-panel {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
        }
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #334155;
        }
        .results-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #e4e4e7;
        }
        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .status-running {
            background: rgba(234, 179, 8, 0.2);
            color: #fbbf24;
            border: 1px solid #fbbf24;
        }
        .status-complete {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid #10b981;
        }
        .status-error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid #ef4444;
        }

        .log-container {
            background: #000;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .log-entry {
            padding: 6px 0;
            border-bottom: 1px solid #1e293b;
            color: #10b981;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        .log-entry.ai-log {
            color: #a855f7;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #1e293b;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #a855f7, #c084fc);
            animation: progress 2s ease-in-out infinite;
        }
        @keyframes progress {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .alert-warning {
            background: rgba(234, 179, 8, 0.1);
            border: 1px solid #eab308;
            color: #fbbf24;
        }

        .vuln-card {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            border-left: 4px solid #ef4444;
            border-radius: 8px;
            padding: 18px;
            margin-bottom: 15px;
        }
        .vuln-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .vuln-type {
            font-weight: 600;
            font-size: 1.1rem;
            color: #e4e4e7;
        }
        .severity-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }
        .severity-critical { background: #7f1d1d; color: #fca5a5; }
        .severity-high { background: #7c2d12; color: #fdba74; }
        .severity-medium { background: #713f12; color: #fde047; }
        .severity-low { background: #1e3a8a; color: #93c5fd; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const API = 'http://localhost:8888';

        function Dashboard() {
            const [scanMode, setScanMode] = useState('quick');
            const [target, setTarget] = useState('');
            const [scanning, setScanning] = useState(false);
            const [scanResults, setScanResults] = useState(null);
            const logContainerRef = useRef(null);

            useEffect(() => {
                if (logContainerRef.current) {
                    logContainerRef.current.scrollTop = logContainerRef.current.scrollHeight;
                }
            }, [scanResults]);

            const startAiAutoPentest = async () => {
                setScanning(true);
                const logs = ['ü§ñ AI Auto-Pentest starting...', 'üß† Analyzing target: ' + target];
                setScanResults({ status: 'running', logs, vulnerabilities: [], actions: [] });

                try {
                    // Call REAL AI workflow
                    const res = await fetch(`${API}/api/workflow/autonomous`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ target })
                    });

                    const data = await res.json();
                    
                    if (data.success && data.results) {
                        const result = data.results;
                        
                        // Extract logs from actions
                        const actionLogs = result.actions_taken.map(action => 
                            `üîß Step ${action.step}: ${action.action}`
                        );
                        
                        // Create final logs
                        const finalLogs = [
                            ...logs,
                            ...actionLogs,
                            `‚úÖ AI workflow complete`,
                            `üìä Found ${result.vulnerabilities_found.length} vulnerabilities`,
                            `üéØ Generated ${result.exploits_generated.length} exploits`
                        ];

                        setScanResults({
                            status: 'complete',
                            logs: finalLogs,
                            vulnerabilities: result.vulnerabilities_found,
                            exploits: result.exploits_generated,
                            actions: result.actions_taken,
                            report: data.report,
                            target
                        });
                    } else {
                        throw new Error(data.error || 'AI workflow failed');
                    }

                } catch (err) {
                    setScanResults({
                        status: 'error',
                        logs: ['‚ùå AI Auto-Pentest failed: ' + err.message],
                        vulnerabilities: []
                    });
                } finally {
                    setScanning(false);
                }
            };

            const startRegularScan = async () => {
                alert('Regular scans not implemented yet. Use AI Auto-Pentest mode.');
            };

            const startScan = () => {
                if (!target) {
                    alert('‚ö†Ô∏è Please enter a target URL');
                    return;
                }

                if (scanMode === 'ai') {
                    startAiAutoPentest();
                } else {
                    startRegularScan();
                }
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>üî• KameLionStack</h1>
                        <p className="subtitle">LLM-Powered Pentesting Platform</p>
                    </div>

                    <div className="alert alert-warning">
                        <span>‚ö†Ô∏è</span>
                        <span><strong>Legal Notice:</strong> Only scan targets you have explicit authorization to test.</span>
                    </div>

                    <div className="scan-card">
                        <h2 style={{marginBottom: '25px', fontSize: '1.5rem'}}>Configure Scan</h2>

                        <div className="mode-selector">
                            <div 
                                className={`mode-btn ${scanMode === 'quick' ? 'active' : ''}`}
                                onClick={() => setScanMode('quick')}
                            >
                                <div className="mode-icon">‚ö°</div>
                                <div className="mode-title">Quick Scan</div>
                                <div className="mode-desc">Fast reconnaissance</div>
                                <div className="mode-time">‚è±Ô∏è ~1-2 min</div>
                            </div>

                            <div 
                                className={`mode-btn ${scanMode === 'full' ? 'active' : ''}`}
                                onClick={() => setScanMode('full')}
                            >
                                <div className="mode-icon">üî•</div>
                                <div className="mode-title">Full Scan</div>
                                <div className="mode-desc">Comprehensive testing</div>
                                <div className="mode-time">‚è±Ô∏è ~3-5 min</div>
                            </div>

                            <div 
                                className={`mode-btn ai-mode ${scanMode === 'ai' ? 'active' : ''}`}
                                onClick={() => setScanMode('ai')}
                            >
                                <div className="mode-icon">ü§ñ</div>
                                <div className="mode-title">AI Auto-Pentest</div>
                                <div className="mode-desc">Autonomous AI-driven pentesting</div>
                                <div className="mode-time">‚è±Ô∏è ~5-10 min</div>
                            </div>
                        </div>

                        <div className="form-group">
                            <label className="form-label">Target URL</label>
                            <input
                                type="text"
                                className="form-input"
                                placeholder="https://example.com or http://192.168.1.1"
                                value={target}
                                onChange={(e) => setTarget(e.target.value)}
                                disabled={scanning}
                            />
                        </div>

                        <button 
                            className={`btn ${scanMode === 'ai' ? 'btn-ai' : 'btn-primary'}`}
                            onClick={startScan}
                            disabled={scanning || !target}
                        >
                            {scanning ? (
                                <>‚è≥ {scanMode === 'ai' ? 'AI Working...' : 'Scanning...'}</>
                            ) : (
                                <>üöÄ Start {scanMode === 'ai' ? 'AI Auto-Pentest' : scanMode === 'quick' ? 'Quick Scan' : 'Full Scan'}</>
                            )}
                        </button>
                    </div>

                    {scanResults && (
                        <div className="results-panel">
                            <div className="results-header">
                                <h3 className="results-title">
                                    {scanMode === 'ai' ? 'ü§ñ AI Auto-Pentest Results' : 'Scan Results'}
                                </h3>
                                <span className={`status-badge status-${scanResults.status}`}>
                                    {scanResults.status === 'running' && 'üîÑ Running'}
                                    {scanResults.status === 'complete' && '‚úÖ Complete'}
                                    {scanResults.status === 'error' && '‚ùå Error'}
                                </span>
                            </div>

                            {scanning && (
                                <div className="progress-bar">
                                    <div className="progress-fill"></div>
                                </div>
                            )}

                            <div className="log-container" ref={logContainerRef}>
                                {scanResults.logs.map((log, i) => (
                                    <div key={i} className={`log-entry ${log.includes('ü§ñ') || log.includes('üß†') ? 'ai-log' : ''}`}>
                                        {log}
                                    </div>
                                ))}
                            </div>

                            {scanResults.vulnerabilities && scanResults.vulnerabilities.length > 0 && (
                                <div style={{marginTop: '20px'}}>
                                    <h4 style={{color: '#ef4444', marginBottom: '15px'}}>
                                        üö® {scanResults.vulnerabilities.length} Vulnerabilities Found
                                    </h4>
                                    {scanResults.vulnerabilities.map((vuln, i) => (
                                        <div key={i} className="vuln-card">
                                            <div className="vuln-header">
                                                <span className="vuln-type">{vuln.type || 'Vulnerability'}</span>
                                                <span className={`severity-badge severity-${(vuln.severity || 'medium').toLowerCase()}`}>
                                                    {vuln.severity || 'MEDIUM'}
                                                </span>
                                            </div>
                                            <p style={{color: '#cbd5e1'}}>{vuln.description || JSON.stringify(vuln)}</p>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {scanResults.status === 'complete' && (!scanResults.vulnerabilities || scanResults.vulnerabilities.length === 0) && (
                                <div style={{textAlign: 'center', padding: '40px', color: '#64748b'}}>
                                    <div style={{fontSize: '3rem', marginBottom: '15px'}}>‚úÖ</div>
                                    <h3>No Critical Vulnerabilities Detected</h3>
                                    <p style={{marginTop: '10px'}}>The target appears secure based on this scan</p>
                                </div>
                            )}

                            {scanResults.report && (
                                <div style={{marginTop: '20px'}}>
                                    <button 
                                        className="btn btn-primary"
                                        onClick={() => {
                                            const blob = new Blob([scanResults.report], { type: 'text/plain' });
                                            const url = URL.createObjectURL(blob);
                                            const a = document.createElement('a');
                                            a.href = url;
                                            a.download = `kamelionstack_report_${Date.now()}.txt`;
                                            a.click();
                                            URL.revokeObjectURL(url);
                                        }}
                                    >
                                        üì• Download Full Report
                                    </button>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>